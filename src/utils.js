import { __awaiter } from "tslib";
import { ItemView, } from "obsidian";
import { readNodeContent } from "./obsidian/fileUtil";
// from obsidian-chat-stream
/**
 * Generate a string of random hexadecimal chars
 */
export const randomHexString = (len) => {
    const t = [];
    for (let n = 0; n < len; n++) {
        t.push(((16 * Math.random()) | 0).toString(16));
    }
    return t.join("");
};
export const getActiveCanvas = (app) => {
    const maybeCanvasView = app.workspace.getActiveViewOfType(ItemView);
    return maybeCanvasView ? maybeCanvasView["canvas"] : null;
};
export const createCanvasGroup = (app, groupName, notesContents) => {
    const canvas = getActiveCanvas(app);
    if (!canvas)
        return;
    const NOTE_WIDTH = 500;
    const NOTE_HEIGHT = 150;
    const NOTE_GAP = 20;
    const NOTES_BY_ROW = 3;
    let startPos = {
        // @ts-expect-error
        x: canvas.x - ((NOTE_WIDTH + NOTE_GAP) * NOTES_BY_ROW) / 2,
        // @ts-expect-error
        y: canvas.y - ((NOTE_HEIGHT + NOTE_GAP) * 2) / 2,
    };
    // @ts-expect-error
    const newGroup = canvas.createGroupNode({
        // TODO : does not work
        label: groupName,
        pos: {
            x: startPos.x - NOTE_GAP,
            y: startPos.y - NOTE_GAP,
        },
        size: {
            width: NOTES_BY_ROW * (NOTE_WIDTH + NOTE_GAP) + NOTE_GAP,
            height: (NOTE_HEIGHT + NOTE_GAP) * 2 + NOTE_GAP,
        },
    });
    newGroup.label = groupName;
    newGroup.labelEl.setText(groupName);
    let countRow = 0;
    let countColumn = 0;
    for (const noteContent of notesContents) {
        const newNode = canvas.createTextNode({
            text: noteContent,
            pos: {
                x: startPos.x + countRow * (NOTE_WIDTH + NOTE_GAP),
                y: startPos.y + countColumn * (NOTE_HEIGHT + NOTE_GAP),
            },
            size: {
                width: NOTE_WIDTH,
                height: NOTE_HEIGHT,
            },
        });
        canvas.addNode(newNode);
        countColumn =
            countRow + 1 > NOTES_BY_ROW - 1 ? countColumn + 1 : countColumn;
        countRow = countRow + 1 > NOTES_BY_ROW - 1 ? 0 : countRow + 1;
    }
    // @ts-expect-error
    canvas.addGroup(newGroup);
};
export const canvasNodeIsNote = (canvasNode) => {
    // @ts-expect-error
    return !canvasNode.from;
};
export const getActiveCanvasNodes = (app) => {
    const canvas = getActiveCanvas(app);
    if (!canvas)
        return;
    return Array.from(canvas.selection);
};
export const getCanvasActiveNoteText = (app) => {
    const canvasNodes = getActiveCanvasNodes(app);
    if (!canvasNodes || canvasNodes.length !== 1)
        return;
    const canvasNode = canvasNodes.first();
    if (!canvasNodeIsNote(canvasNode))
        return;
    return readNodeContent(canvasNode);
};
// export const addImageToCanvas = (app: App, imageFileName: string) => {
// 	const canvas = getActiveCanvas(app);
// 	if (!canvas) return;
// 	const parentNode = getActiveCanvasNodes(app)?.[0];
// 	if (!parentNode) return;
// 	const IMAGE_WIDTH = parentNode.width;
// 	const IMAGE_HEIGHT = IMAGE_WIDTH * (1024 / 1792) + 20;
// 	createNode(
// 		canvas,
// 		{
// 			text: `![[${imageFileName}]]`,
// 			size: {
// 				width: IMAGE_WIDTH,
// 				height: IMAGE_HEIGHT,
// 			},
// 		},
// 		parentNode
// 	);
// 	canvas.requestSave();
// };
export const getImageSaveFolderPath = (app, settings) => __awaiter(void 0, void 0, void 0, function* () {
    // @ts-expect-error
    const attachments = (yield app.vault.getAvailablePathForAttachments())
        .split("/")
        .slice(0, -1)
        .join("/");
    console.log({ attachments });
    return attachments;
    // // @ts-expect-error
    // return settings.imagesPath || app.vault.config.attachmentFolderPath;
});
export function getYouTubeVideoId(url) {
    // This pattern will match the following types of YouTube URLs:
    // - http://www.youtube.com/watch?v=VIDEO_ID
    // - http://www.youtube.com/watch?v=VIDEO_ID&...
    // - http://www.youtube.com/embed/VIDEO_ID
    // - http://youtu.be/VIDEO_ID
    // The capture group (VIDEO_ID) is the YouTube video ID
    const pattern = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
    const match = url.match(pattern);
    return match ? match[1] : null;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUlOLFFBQVEsR0FLUixNQUFNLFVBQVUsQ0FBQztBQUVsQixPQUFPLEVBQW1CLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3ZFLDRCQUE0QjtBQUU1Qjs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxDQUFDLEdBQVcsRUFBRSxFQUFFO0lBQzlDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUNiLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDN0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQ2hEO0lBQ0QsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ25CLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxDQUFDLEdBQVEsRUFBRSxFQUFFO0lBQzNDLE1BQU0sZUFBZSxHQUFHLEdBQUcsQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQ3hELFFBQVEsQ0FDYSxDQUFDO0lBQ3ZCLE9BQU8sZUFBZSxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztBQUMzRCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxDQUNoQyxHQUFRLEVBQ1IsU0FBaUIsRUFDakIsYUFBdUIsRUFDdEIsRUFBRTtJQUNILE1BQU0sTUFBTSxHQUFHLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwQyxJQUFJLENBQUMsTUFBTTtRQUFF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LENBQUM7SUFDbkIsc0JBQXNCO0lBQ3RCLHVFQUF1RTtBQUN4RSxDQUFDLENBQUEsQ0FBQztBQUVGLE1BQU0sVUFBVSxpQkFBaUIsQ0FBQyxHQUFXO0lBQzVDLCtEQUErRDtJQUMvRCw0Q0FBNEM7SUFDNUMsZ0RBQWdEO0lBQ2hELDBDQUEwQztJQUMxQyw2QkFBNkI7SUFDN0IsdURBQXVEO0lBQ3ZELE1BQU0sT0FBTyxHQUNaLDZGQUE2RixDQUFDO0lBQy9GLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDakMsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ2hDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuXHRBcHAsXG5cdENhbnZhcyxcblx0Q2FudmFzQ29vcmRzLFxuXHRJdGVtVmlldyxcblx0TWVudSxcblx0TWVudUl0ZW0sXG5cdFRGaWxlLFxuXHRDYW52YXNHcm91cE5vZGUsXG59IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgQ2FudmFzVmlldywgY3JlYXRlTm9kZSB9IGZyb20gXCIuL29ic2lkaWFuL2NhbnZhcy1wYXRjaGVzXCI7XG5pbXBvcnQgeyByZWFkRmlsZUNvbnRlbnQsIHJlYWROb2RlQ29udGVudCB9IGZyb20gXCIuL29ic2lkaWFuL2ZpbGVVdGlsXCI7XG5pbXBvcnQgeyBDYW52YXNOb2RlIH0gZnJvbSBcIi4vb2JzaWRpYW4vY2FudmFzLWludGVybmFsXCI7XG5pbXBvcnQgeyBBdWdtZW50ZWRDYW52YXNTZXR0aW5ncyB9IGZyb20gXCIuL3NldHRpbmdzL0F1Z21lbnRlZENhbnZhc1NldHRpbmdzXCI7XG4vLyBmcm9tIG9ic2lkaWFuLWNoYXQtc3RyZWFtXG5cbi8qKlxuICogR2VuZXJhdGUgYSBzdHJpbmcgb2YgcmFuZG9tIGhleGFkZWNpbWFsIGNoYXJzXG4gKi9cbmV4cG9ydCBjb25zdCByYW5kb21IZXhTdHJpbmcgPSAobGVuOiBudW1iZXIpID0+IHtcblx0Y29uc3QgdCA9IFtdO1xuXHRmb3IgKGxldCBuID0gMDsgbiA8IGxlbjsgbisrKSB7XG5cdFx0dC5wdXNoKCgoMTYgKiBNYXRoLnJhbmRvbSgpKSB8IDApLnRvU3RyaW5nKDE2KSk7XG5cdH1cblx0cmV0dXJuIHQuam9pbihcIlwiKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRBY3RpdmVDYW52YXMgPSAoYXBwOiBBcHApID0+IHtcblx0Y29uc3QgbWF5YmVDYW52YXNWaWV3ID0gYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKFxuXHRcdEl0ZW1WaWV3XG5cdCkgYXMgQ2FudmFzVmlldyB8IG51bGw7XG5cdHJldHVybiBtYXliZUNhbnZhc1ZpZXcgPyBtYXliZUNhbnZhc1ZpZXdbXCJjYW52YXNcIl0gOiBudWxsO1xufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNhbnZhc0dyb3VwID0gKFxuXHRhcHA6IEFwcCxcblx0Z3JvdXBOYW1lOiBzdHJpbmcsXG5cdG5vdGVzQ29udGVudHM6IHN0cmluZ1tdXG4pID0+IHtcblx0Y29uc3QgY2FudmFzID0gZ2V0QWN0aXZlQ2FudmFzKGFwcCk7XG5cdGlmICghY2FudmFzKSByZXR1cm47XG5cblx0Y29uc3QgTk9URV9XSURUSCA9IDUwMDtcblx0Y29uc3QgTk9URV9IRUlHSFQgPSAxNTA7XG5cdGNvbnN0IE5PVEVfR0FQID0gMjA7XG5cblx0Y29uc3QgTk9URVNfQllfUk9XID0gMztcblxuXHRsZXQgc3RhcnRQb3MgPSB7XG5cdFx0Ly8gQHRzLWV4cGVjdC1lcnJvclxuXHRcdHg6IGNhbnZhcy54IC0gKChOT1RFX1dJRFRIICsgTk9URV9HQVApICogTk9URVNfQllfUk9XKSAvIDIsXG5cdFx0Ly8gQHRzLWV4cGVjdC1lcnJvclxuXHRcdHk6IGNhbnZhcy55IC0gKChOT1RFX0hFSUdIVCArIE5PVEVfR0FQKSAqIDIpIC8gMixcblx0fTtcblxuXHQvLyBAdHMtZXhwZWN0LWVycm9yXG5cdGNvbnN0IG5ld0dyb3VwOiBDYW52YXNHcm91cE5vZGUgPSBjYW52YXMuY3JlYXRlR3JvdXBOb2RlKHtcblx0XHQvLyBUT0RPIDogZG9lcyBub3Qgd29ya1xuXHRcdGxhYmVsOiBncm91cE5hbWUsXG5cdFx0cG9zOiB7XG5cdFx0XHR4OiBzdGFydFBvcy54IC0gTk9URV9HQVAsXG5cdFx0XHR5OiBzdGFydFBvcy55IC0gTk9URV9HQVAsXG5cdFx0fSxcblx0XHRzaXplOiB7XG5cdFx0XHR3aWR0aDogTk9URVNfQllfUk9XICogKE5PVEVfV0lEVEggKyBOT1RFX0dBUCkgKyBOT1RFX0dBUCxcblx0XHRcdGhlaWdodDogKE5PVEVfSEVJR0hUICsgTk9URV9HQVApICogMiArIE5PVEVfR0FQLFxuXHRcdH0sXG5cdH0pO1xuXHRuZXdHcm91cC5sYWJlbCA9IGdyb3VwTmFtZTtcblx0bmV3R3JvdXAubGFiZWxFbC5zZXRUZXh0KGdyb3VwTmFtZSk7XG5cblx0bGV0IGNvdW50Um93ID0gMDtcblx0bGV0IGNvdW50Q29sdW1uID0gMDtcblx0Zm9yIChjb25zdCBub3RlQ29udGVudCBvZiBub3Rlc0NvbnRlbnRzKSB7XG5cdFx0Y29uc3QgbmV3Tm9kZSA9IGNhbnZhcy5jcmVhdGVUZXh0Tm9kZSh7XG5cdFx0XHR0ZXh0OiBub3RlQ29udGVudCxcblx0XHRcdHBvczoge1xuXHRcdFx0XHR4OiBzdGFydFBvcy54ICsgY291bnRSb3cgKiAoTk9URV9XSURUSCArIE5PVEVfR0FQKSxcblx0XHRcdFx0eTogc3RhcnRQb3MueSArIGNvdW50Q29sdW1uICogKE5PVEVfSEVJR0hUICsgTk9URV9HQVApLFxuXHRcdFx0fSxcblx0XHRcdHNpemU6IHtcblx0XHRcdFx0d2lkdGg6IE5PVEVfV0lEVEgsXG5cdFx0XHRcdGhlaWdodDogTk9URV9IRUlHSFQsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXHRcdGNhbnZhcy5hZGROb2RlKG5ld05vZGUpO1xuXHRcdGNvdW50Q29sdW1uID1cblx0XHRcdGNvdW50Um93ICsgMSA+IE5PVEVTX0JZX1JPVyAtIDEgPyBjb3VudENvbHVtbiArIDEgOiBjb3VudENvbHVtbjtcblx0XHRjb3VudFJvdyA9IGNvdW50Um93ICsgMSA+IE5PVEVTX0JZX1JPVyAtIDEgPyAwIDogY291bnRSb3cgKyAxO1xuXHR9XG5cblx0Ly8gQHRzLWV4cGVjdC1lcnJvclxuXHRjYW52YXMuYWRkR3JvdXAobmV3R3JvdXApO1xufTtcblxuZXhwb3J0IGNvbnN0IGNhbnZhc05vZGVJc05vdGUgPSAoY2FudmFzTm9kZTogQ2FudmFzTm9kZSkgPT4ge1xuXHQvLyBAdHMtZXhwZWN0LWVycm9yXG5cdHJldHVybiAhY2FudmFzTm9kZS5mcm9tO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEFjdGl2ZUNhbnZhc05vZGVzID0gKGFwcDogQXBwKSA9PiB7XG5cdGNvbnN0IGNhbnZhcyA9IGdldEFjdGl2ZUNhbnZhcyhhcHApO1xuXHRpZiAoIWNhbnZhcykgcmV0dXJuO1xuXG5cdHJldHVybiA8Q2FudmFzTm9kZVtdPkFycmF5LmZyb20oY2FudmFzLnNlbGVjdGlvbikhO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENhbnZhc0FjdGl2ZU5vdGVUZXh0ID0gKGFwcDogQXBwKSA9PiB7XG5cdGNvbnN0IGNhbnZhc05vZGVzID0gZ2V0QWN0aXZlQ2FudmFzTm9kZXMoYXBwKTtcblx0aWYgKCFjYW52YXNOb2RlcyB8fCBjYW52YXNOb2Rlcy5sZW5ndGggIT09IDEpIHJldHVybjtcblxuXHRjb25zdCBjYW52YXNOb2RlID0gY2FudmFzTm9kZXMuZmlyc3QoKSE7XG5cdGlmICghY2FudmFzTm9kZUlzTm90ZShjYW52YXNOb2RlKSkgcmV0dXJuO1xuXG5cdHJldHVybiByZWFkTm9kZUNvbnRlbnQoY2FudmFzTm9kZSk7XG59O1xuXG4vLyBleHBvcnQgY29uc3QgYWRkSW1hZ2VUb0NhbnZhcyA9IChhcHA6IEFwcCwgaW1hZ2VGaWxlTmFtZTogc3RyaW5nKSA9PiB7XG4vLyBcdGNvbnN0IGNhbnZhcyA9IGdldEFjdGl2ZUNhbnZhcyhhcHApO1xuLy8gXHRpZiAoIWNhbnZhcykgcmV0dXJuO1xuXG4vLyBcdGNvbnN0IHBhcmVudE5vZGUgPSBnZXRBY3RpdmVDYW52YXNOb2RlcyhhcHApPy5bMF07XG4vLyBcdGlmICghcGFyZW50Tm9kZSkgcmV0dXJuO1xuXG4vLyBcdGNvbnN0IElNQUdFX1dJRFRIID0gcGFyZW50Tm9kZS53aWR0aDtcbi8vIFx0Y29uc3QgSU1BR0VfSEVJR0hUID0gSU1BR0VfV0lEVEggKiAoMTAyNCAvIDE3OTIpICsgMjA7XG5cbi8vIFx0Y3JlYXRlTm9kZShcbi8vIFx0XHRjYW52YXMsXG4vLyBcdFx0e1xuLy8gXHRcdFx0dGV4dDogYCFbWyR7aW1hZ2VGaWxlTmFtZX1dXWAsXG4vLyBcdFx0XHRzaXplOiB7XG4vLyBcdFx0XHRcdHdpZHRoOiBJTUFHRV9XSURUSCxcbi8vIFx0XHRcdFx0aGVpZ2h0OiBJTUFHRV9IRUlHSFQsXG4vLyBcdFx0XHR9LFxuLy8gXHRcdH0sXG4vLyBcdFx0cGFyZW50Tm9kZVxuLy8gXHQpO1xuXG4vLyBcdGNhbnZhcy5yZXF1ZXN0U2F2ZSgpO1xuLy8gfTtcblxuZXhwb3J0IGNvbnN0IGdldEltYWdlU2F2ZUZvbGRlclBhdGggPSBhc3luYyAoXG5cdGFwcDogQXBwLFxuXHRzZXR0aW5nczogQXVnbWVudGVkQ2FudmFzU2V0dGluZ3NcbikgPT4ge1xuXHQvLyBAdHMtZXhwZWN0LWVycm9yXG5cdGNvbnN0IGF0dGFjaG1lbnRzID0gKGF3YWl0IGFwcC52YXVsdC5nZXRBdmFpbGFibGVQYXRoRm9yQXR0YWNobWVudHMoKSlcblx0XHQuc3BsaXQoXCIvXCIpXG5cdFx0LnNsaWNlKDAsIC0xKVxuXHRcdC5qb2luKFwiL1wiKTtcblx0Y29uc29sZS5sb2coeyBhdHRhY2htZW50cyB9KTtcblxuXHRyZXR1cm4gYXR0YWNobWVudHM7XG5cdC8vIC8vIEB0cy1leHBlY3QtZXJyb3Jcblx0Ly8gcmV0dXJuIHNldHRpbmdzLmltYWdlc1BhdGggfHwgYXBwLnZhdWx0LmNvbmZpZy5hdHRhY2htZW50Rm9sZGVyUGF0aDtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRZb3VUdWJlVmlkZW9JZCh1cmw6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuXHQvLyBUaGlzIHBhdHRlcm4gd2lsbCBtYXRjaCB0aGUgZm9sbG93aW5nIHR5cGVzIG9mIFlvdVR1YmUgVVJMczpcblx0Ly8gLSBodHRwOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9VklERU9fSURcblx0Ly8gLSBodHRwOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9VklERU9fSUQmLi4uXG5cdC8vIC0gaHR0cDovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9WSURFT19JRFxuXHQvLyAtIGh0dHA6Ly95b3V0dS5iZS9WSURFT19JRFxuXHQvLyBUaGUgY2FwdHVyZSBncm91cCAoVklERU9fSUQpIGlzIHRoZSBZb3VUdWJlIHZpZGVvIElEXG5cdGNvbnN0IHBhdHRlcm4gPVxuXHRcdC8oPzp5b3V0dWJlXFwuY29tXFwvKD86W15cXC9dK1xcLy4rXFwvfCg/OnZ8ZSg/Om1iZWQpPylcXC98LipbPyZddj0pfHlvdXR1XFwuYmVcXC8pKFteXCImP1xcL1xcc117MTF9KS9pO1xuXHRjb25zdCBtYXRjaCA9IHVybC5tYXRjaChwYXR0ZXJuKTtcblx0cmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0gOiBudWxsO1xufVxuIl19